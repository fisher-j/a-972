<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Calculate summary statistics</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">A-972 10-year Study</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="01_import.html">Data import</a>
</li>
<li>
  <a href="02_data_cleaning.html">Data cleaning</a>
</li>
<li>
  <a href="03_define.html">Define new variables</a>
</li>
<li>
  <a href="04_pred_ht.html">Predicting missing heights</a>
</li>
<li>
  <a href="05_analyzing_ba_increment.html">Analyzing Ba increment</a>
</li>
<li>
  <a href="06_summary.html">Data summaries and figures</a>
</li>
<li>
  <a href="07_initial_conditions.html">Initial conditons</a>
</li>
<li>
  <a href="08_variability.html">Variability</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Calculate summary statistics</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#summary-measures">Summary measures</a>
<ul>
<li><a href="#density">Density</a></li>
<li><a href="#mortality">Mortality</a></li>
<li><a href="#qmd">Qmd</a></li>
<li><a href="#heights">Heights</a></li>
<li><a href="#basal-area">Basal Area</a>
<ul>
<li><a href="#compare-to-teraoka-2016">Compare to Teraoka (2016)</a></li>
</ul></li>
<li><a href="#sdi">SDI</a></li>
<li><a href="#density-of-dominant">Density of dominant</a></li>
</ul></li>
<li><a href="#initial-summary-tables">Initial summary tables</a>
<ul>
<li><a href="#all-species">All species</a></li>
<li><a href="#redwood">Redwood</a></li>
<li><a href="#douglas-fir">Douglas-fir</a></li>
</ul></li>
<li><a href="#figures">Figures</a></li>
<li><a href="#species-dominance">Species dominance</a>
<ul>
<li><a href="#dominance-figure">Dominance figure</a></li>
<li><a href="#species-dominance-significance-test">Species dominance significance test</a></li>
</ul></li>
</ul>
</div>

<pre class="r"><code>library(tidyverse)
library(dplyr)</code></pre>
<div id="summary-measures" class="section level1">
<h1>Summary measures</h1>
<p>I’m making the assumption now that all trees recorded as cut were alive in the initial conditions. For all of the following I use trees with status 1, 2, 3, 15, 16. Fifteen and 16 are cut trees, but in the long data format, they only occur on entries where year = “init” so they do not affect other periods. Status 1, 2 and 3 represent second-growth, advanced regen, and old-growth, respectively.</p>
<p>Generally, the <code>summarise()</code> command in each section defines the output of a given measure. The <code>mutate()</code> command is also used for calculating new columns. Calculations are done by grouping levels (generally by treatment, by year).</p>
<pre class="r"><code># I&#39;ll store all my metrics in this list
measures &lt;- list()</code></pre>
<div id="density" class="section level2">
<h2>Density</h2>
<p>I’ll look at a quick summary of quartiles of the number of tree observations by plot for each year. Initial plots had between 83 and 164 observations and subsequent years are roughly parallel. Density is being calculated for all live trees, including those broken above dbh.</p>
<pre class="r"><code>d_l %&gt;%
  filter(status %in% c(1, 2, 3, 15, 16, 31)) %&gt;%
  group_by(year, plot) %&gt;%
  summarize(n = n()) %&gt;%
  summarize(as_tibble_row(quantile(n)))</code></pre>
<pre><code>## # A tibble: 4 x 6
##   year   `0%` `25%` `50%` `75%` `100%`
##   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 init     83 124   134.  143.     164
## 2 08       26  40.8  84   108.     147
## 3 13       21  35.5  79    94      117
## 4 18       20  33.5  74.5  84.5     92</code></pre>
<pre class="r"><code>measures$density &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(spp %in% species, live | status %in% c(15, 16)) %&gt;%
    group_by(treatment, year, plot) %&gt;%
    # expansion factor 12.5 (12.5 * .08 = 1 ha)
    summarise(density_plot = n() * 12.5) %&gt;%
    summarise(
      mean = mean(density_plot),
      n = n(),
      std = sd(density_plot)
    )
}</code></pre>
</div>
<div id="mortality" class="section level2">
<h2>Mortality</h2>
<p>New mortality here is ascribed to observations of the current period which were alive in the previous period and are not alive in the current period and reported in tph. Currently, this is undefined for the first period (“init”) and is zero for “08” (because “init” and “08” are really only one observation). The values for 2013 and 2018 record the new mortality in the previous period, i.e.: 08-13 and 13-18, respectively.</p>
<pre class="r"><code>measures$mort &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(spp %in% species) %&gt;%
    group_by(tree_id) %&gt;%
    mutate(mort = ((live == FALSE) * (lag(live) == TRUE)) &gt; 0) %&gt;%
    group_by(year, treatment, plot) %&gt;%
    summarize(mort_plot = sum(mort) * 12.5) %&gt;%
    summarize(
      mean = mean(mort_plot),
      n = n(),
      std = sd(mort_plot)
    )
}</code></pre>
</div>
<div id="qmd" class="section level2">
<h2>Qmd</h2>
<p>DBH is actually QMD here. It will be calculated based on all live trees, including those broken above dbh and with broken and dead tops (most of these are SESE and assumed to be alive).</p>
<pre class="r"><code>measures$dbh &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(spp %in% species, live | status %in% c(15, 16)) %&gt;%
    group_by(treatment, year, plot) %&gt;%
    summarise(plot_mean = sqrt(mean(dbh^2))) %&gt;%
    summarise(
      mean = mean(plot_mean),
      n = n(),
      std = sd(plot_mean)
    )
}

measures$dom_dbh &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(live | status %in% c(15, 16)) %&gt;%
    group_by(plot, year) %&gt;%
    slice_max(order_by = dbh, n = 8, with_ties = FALSE) %&gt;%
    filter(spp %in% species) %&gt;%
    group_by(treatment, year) %&gt;%
    summarise(
      mean = mean(dbh),
      n = n(),
      std = sd(dbh))
}</code></pre>
</div>
<div id="heights" class="section level2">
<h2>Heights</h2>
<p>Heights will be determined using only trees with unbroken, live crowns.</p>
<p>Because there are about 14 observations in 2008 and 2013 that do not have height measurements, I am omitting these from analysis for now. Also, I am only looking at trees that have height measurements in 2018. This means that of the 3,538 total height observations, I am only looking at 1,929 over the the three measurement periods.</p>
<p>For dominant heights, I am using dominant dbh trees <em>not including broken and dead tops</em>. Not all of these have heights. For this reason, there are fewer than 4 trees per plot.</p>
<pre class="r"><code># get ids of trees that have heights in 2018
ht_id_2018 &lt;- filter(d_l, year == &quot;18&quot;, !is.na(ht_p)) %&gt;% pull(tree_id)

# average height I AM OMMITING MISSING HEIGHT MEASUREMENTS.
measures$ht_p &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(
      spp %in% species,
      live | status %in% c(15, 16),
      !get_cond(c(2, 3)),
      tree_id %in% ht_id_2018,
      !is.na(ht_p)
    ) %&gt;%
  group_by(treatment, year, plot) %&gt;%
  summarise(plot_mean = mean(ht_p)) %&gt;%
  summarise(
    mean = mean(plot_mean),
    n = n(),
    std = sd(plot_mean)
  )
}

# Dominant height
# I AM CALCULATING DOM HEIGHT ONLY FROM THOSE AVAILABLE
measures$dom_ht &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(
      live | status %in% c(15, 16),
      !get_cond(2, 3),
      tree_id %in% ht_id_2018
    ) %&gt;%
    group_by(plot, year) %&gt;%
    slice_max(order_by = ht_p, n = 8, with_ties = FALSE) %&gt;%
    filter(spp %in% species) %&gt;%
    group_by(treatment, year) %&gt;%
    summarise(
      mean = mean(ht_p, na.rm = TRUE),
      n = sum(!is.na(ht_p)),
      std = sd(ht_p, na.rm = TRUE)
    )
}</code></pre>
</div>
<div id="basal-area" class="section level2">
<h2>Basal Area</h2>
<p>Basal area, similar to density will be calculated for all live trees.</p>
<pre class="r"><code>measures$ba &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(spp %in% species, live | status %in% c(15, 16)) %&gt;%
    group_by(treatment, year, plot) %&gt;%
    summarise(
      # I&#39;m calculating BA (m^2/ha) by plot
      ba_plot = sum(dbh^2 * pi / 40000, na.rm = TRUE) * 12.5,
      .groups = &quot;drop_last&quot;
    ) %&gt;%
    summarize(
      # And averagging over plots within a treatment
      mean = mean(ba_plot),
      n = n(),
      std = sd(ba_plot),
      .groups = &quot;drop_last&quot;
    )
}</code></pre>
<div id="compare-to-teraoka-2016" class="section level3">
<h3>Compare to Teraoka (2016)</h3>
<p>I want to create another function for calculating basal area. This should return basal area in m<sup>2</sup>/ha:</p>
<ol style="list-style-type: decimal">
<li>by species</li>
<li>for all species</li>
<li>for a subset of species</li>
<li>it should include all live + harvested trees</li>
</ol>
<p>It turns out that this function is almost identical to my previous one, except that it allows to calculate by species.</p>
<pre class="r"><code>library(tidyverse)

get_ba &lt;- function(data, by_species = FALSE, species_subset = NULL) {
  if(is.null(species_subset)) species_subset &lt;- unique(data$spp)
  if(by_species) {
    grp_vars &lt;- rlang::exprs(treatment, spp, year, plot)
  } else {
    grp_vars &lt;- rlang::exprs(treatment, year, plot)
  }
  data %&gt;%
    filter(spp %in% species_subset, live | status %in% c(15, 16)) %&gt;%
    group_by(!!!grp_vars) %&gt;%
    summarise(
      # I&#39;m calculating BA (m^2/ha) by plot
      ba_plot = sum(dbh^2 * pi / 40000, na.rm = TRUE) * 12.5,
      n_ba = n(),
      .groups = &quot;drop_last&quot;
    ) %&gt;%
    summarize(
      # And averagging over plots within a treatment
      mean = mean(ba_plot),
      n = sum(n_ba),
      std = sd(ba_plot),
      .groups = &quot;drop_last&quot;
    )
}</code></pre>
<p>Here I’ll plot BA by species and year, similar to Teraoka (2016)</p>
<pre class="r"><code>teraoka_colors &lt;- c(&quot;#04315c&quot;, &quot;#EB4332&quot;, &quot;#86E981&quot;, &quot;#557AF0&quot;, &quot;#B3AFAE&quot;)
get_ba(d_l, by_species = TRUE) %&gt;%
  filter(year %in% c(&quot;08&quot;, &quot;13&quot;)) %&gt;%
  mutate(
    treatment = factor(treatment, levels = c(&quot;C&quot;, &quot;H40&quot;, &quot;L40&quot;, &quot;H80&quot;, &quot;L80&quot;)),
    spp = factor(spp, levels = c(&quot;TSHE&quot;, &quot;SESE3&quot;, &quot;PSMEM&quot;, &quot;PISI&quot;, &quot;ALRU2&quot;))
  ) %&gt;%
  ggplot(aes(x = treatment, y = mean)) +
    geom_col(aes(fill = spp)) +
    facet_wrap(vars(year)) +
    labs(x = &quot;Treatment&quot;, fill = &quot;Species&quot;, y = &quot;BA (m^2 / ha)&quot;) +
    scale_fill_manual(values = teraoka_colors)</code></pre>
<p><img src="06_summary_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>It looks pretty similar, but there are discrepancies. Next I’ll print out the percent changes in basal area, again similar to Teraoka et al. (2016), but for both 5-year growth periods.</p>
<p>I define a percent change function which takes output from one of my metric functions (expecting the variable “mean_[variable_name]”)</p>
<pre class="r"><code>pct_change &lt;- function(data, var) {
  mutate(data, pct_change = ({{var}} - lag({{var}})) / lag({{var}})) %&gt;%
  select(-starts_with(c(&quot;n&quot;, &quot;sd&quot;)))
}

get_ba(d_l) %&gt;%
  pct_change(mean)</code></pre>
<pre><code>## # A tibble: 20 x 5
## # Groups:   treatment [5]
##    treatment year   mean    std pct_change
##    &lt;chr&gt;     &lt;ord&gt; &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
##  1 C         init   65.0  5.04     NA     
##  2 C         08     65.0  5.04      0     
##  3 C         13     69.2  3.78      0.0642
##  4 C         18     71.7  3.51      0.0358
##  5 H40       init   74.9 15.6      NA     
##  6 H40       08     33.5  7.15     -0.553 
##  7 H40       13     39.8  8.82      0.188 
##  8 H40       18     47.6 14.7       0.197 
##  9 H80       init   73.7  7.51     NA     
## 10 H80       08     58.4  5.82     -0.208 
## 11 H80       13     65.9  7.86      0.128 
## 12 H80       18     75.6 10.1       0.148 
## 13 L40       init   71.6  4.00     NA     
## 14 L40       08     31.8  0.850    -0.557 
## 15 L40       13     35.7  4.49      0.125 
## 16 L40       18     42.3  6.40      0.185 
## 17 L80       init   68.4 13.0      NA     
## 18 L80       08     54.6 10.6      -0.202 
## 19 L80       13     62.3 12.5       0.141 
## 20 L80       18     71.1 15.5       0.141</code></pre>
</div>
</div>
<div id="sdi" class="section level2">
<h2>SDI</h2>
<p>For SDI, I use the same trees that were used for basal area and density: all standing trees (broken or not) that are taller than breast height.</p>
<pre class="r"><code># do any target trees have missing dbh?
any(nrow(filter(d_l, status %in% c(1, 2, 3, 15, 16), is.na(dbh))))</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>measures$sdi &lt;- function(data, species) {
  if(is.null(species)) species &lt;- unique(data$spp)
  data %&gt;%
    filter(spp %in% species, live | status %in% c(15, 16)) %&gt;%
    group_by(treatment, year, plot) %&gt;%
    summarise(
      sdi_plot = sum(12.5 * (dbh * 0.04)^1.605, na.rm = TRUE)
    ) %&gt;%
    summarize(
      mean = mean(sdi_plot),
      n = n(),
      std = sd(sdi_plot)
    )
}</code></pre>
</div>
<div id="density-of-dominant" class="section level2">
<h2>Density of dominant</h2>
</div>
</div>
<div id="initial-summary-tables" class="section level1">
<h1>Initial summary tables</h1>
<div id="all-species" class="section level2">
<h2>All species</h2>
<pre class="r"><code>get_measures(d_l) %&gt;%
  make_summary() %&gt;%
  kableExtra::kbl() %&gt;%
  kableExtra::kable_classic(full_width = FALSE, html_font = &quot;Garamond&quot;) %&gt;%
  kableExtra::add_header_above(c(&quot; &quot; = 2, &quot;Treatment&quot; = 5)) %&gt;%
  kableExtra::collapse_rows(columns = 1, valign = &quot;top&quot;)</code></pre>
<table class=" lightable-classic" style="font-family: Garamond; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;" colspan="2">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Treatment
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
measure
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
C40
</th>
<th style="text-align:left;">
L40
</th>
<th style="text-align:left;">
C80
</th>
<th style="text-align:left;">
L80
</th>
<th style="text-align:left;">
Control
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
1590.6 (418.0)
</td>
<td style="text-align:left;">
1693.8 (181.0)
</td>
<td style="text-align:left;">
1628.1 (160.2)
</td>
<td style="text-align:left;">
1775.0 (120.3)
</td>
<td style="text-align:left;">
1556.2 (191.1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
496.9 (121.8)
</td>
<td style="text-align:left;">
415.6 (56.2)
</td>
<td style="text-align:left;">
1275.0 (127.9)
</td>
<td style="text-align:left;">
1062.5 (123.7)
</td>
<td style="text-align:left;">
1556.2 (191.1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
434.4 (125.2)
</td>
<td style="text-align:left;">
362.5 (70.0)
</td>
<td style="text-align:left;">
1096.9 (118.8)
</td>
<td style="text-align:left;">
1018.8 (117.5)
</td>
<td style="text-align:left;">
1331.2 (98.2)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
387.5 (91.9)
</td>
<td style="text-align:left;">
343.8 (71.8)
</td>
<td style="text-align:left;">
1015.6 (105.3)
</td>
<td style="text-align:left;">
981.2 (143.4)
</td>
<td style="text-align:left;">
1053.1 (48.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
24.8 (3.1)
</td>
<td style="text-align:left;">
23.3 (1.8)
</td>
<td style="text-align:left;">
24.0 (1.3)
</td>
<td style="text-align:left;">
22.1 (2.2)
</td>
<td style="text-align:left;">
23.1 (0.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
29.6 (3.4)
</td>
<td style="text-align:left;">
31.4 (2.4)
</td>
<td style="text-align:left;">
24.2 (1.4)
</td>
<td style="text-align:left;">
25.6 (2.9)
</td>
<td style="text-align:left;">
23.1 (0.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
34.7 (4.3)
</td>
<td style="text-align:left;">
35.6 (1.5)
</td>
<td style="text-align:left;">
27.7 (1.4)
</td>
<td style="text-align:left;">
27.9 (3.0)
</td>
<td style="text-align:left;">
25.8 (0.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
39.6 (5.4)
</td>
<td style="text-align:left;">
39.8 (2.1)
</td>
<td style="text-align:left;">
30.8 (1.4)
</td>
<td style="text-align:left;">
30.4 (3.4)
</td>
<td style="text-align:left;">
29.5 (1.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
22.0 (1.2)
</td>
<td style="text-align:left;">
23.1 (1.2)
</td>
<td style="text-align:left;">
20.2 (0.5)
</td>
<td style="text-align:left;">
20.6 (1.0)
</td>
<td style="text-align:left;">
21.5 (0.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
21.9 (1.2)
</td>
<td style="text-align:left;">
23.1 (1.2)
</td>
<td style="text-align:left;">
20.2 (0.6)
</td>
<td style="text-align:left;">
20.7 (1.1)
</td>
<td style="text-align:left;">
21.5 (0.7)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
23.6 (1.1)
</td>
<td style="text-align:left;">
25.7 (0.9)
</td>
<td style="text-align:left;">
22.7 (0.7)
</td>
<td style="text-align:left;">
23.2 (1.2)
</td>
<td style="text-align:left;">
23.1 (0.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
25.3 (1.1)
</td>
<td style="text-align:left;">
27.7 (0.8)
</td>
<td style="text-align:left;">
24.4 (0.8)
</td>
<td style="text-align:left;">
25.2 (1.4)
</td>
<td style="text-align:left;">
24.5 (0.7)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
74.9 (15.6)
</td>
<td style="text-align:left;">
71.6 (4.0)
</td>
<td style="text-align:left;">
73.7 (7.5)
</td>
<td style="text-align:left;">
68.4 (13.0)
</td>
<td style="text-align:left;">
65.0 (5.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
33.5 (7.2)
</td>
<td style="text-align:left;">
31.8 (0.8)
</td>
<td style="text-align:left;">
58.4 (5.8)
</td>
<td style="text-align:left;">
54.6 (10.6)
</td>
<td style="text-align:left;">
65.0 (5.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
39.8 (8.8)
</td>
<td style="text-align:left;">
35.7 (4.5)
</td>
<td style="text-align:left;">
65.9 (7.9)
</td>
<td style="text-align:left;">
62.3 (12.5)
</td>
<td style="text-align:left;">
69.2 (3.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
47.6 (14.7)
</td>
<td style="text-align:left;">
42.3 (6.4)
</td>
<td style="text-align:left;">
75.6 (10.1)
</td>
<td style="text-align:left;">
71.1 (15.5)
</td>
<td style="text-align:left;">
71.7 (3.5)
</td>
</tr>
</tbody>
</table>
</div>
<div id="redwood" class="section level2">
<h2>Redwood</h2>
<pre class="r"><code>get_measures(species = &quot;SESE3&quot;) %&gt;%
  make_summary() %&gt;%
  kableExtra::kbl() %&gt;%
  kableExtra::kable_classic(full_width = FALSE, html_font = &quot;Garamond&quot;) %&gt;%
  kableExtra::add_header_above(c(&quot; &quot; = 2, &quot;Treatment&quot; = 5)) %&gt;%
  kableExtra::collapse_rows(columns = 1, valign = &quot;top&quot;)</code></pre>
<table class=" lightable-classic" style="font-family: Garamond; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;" colspan="2">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Treatment
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
measure
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
C40
</th>
<th style="text-align:left;">
L40
</th>
<th style="text-align:left;">
C80
</th>
<th style="text-align:left;">
L80
</th>
<th style="text-align:left;">
Control
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
515.6 (314.6)
</td>
<td style="text-align:left;">
365.6 (133.2)
</td>
<td style="text-align:left;">
571.9 (175.4)
</td>
<td style="text-align:left;">
415.6 (256.0)
</td>
<td style="text-align:left;">
237.5 (72.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
237.5 (121.2)
</td>
<td style="text-align:left;">
146.9 (25.8)
</td>
<td style="text-align:left;">
490.6 (138.6)
</td>
<td style="text-align:left;">
309.4 (173.3)
</td>
<td style="text-align:left;">
237.5 (72.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
206.2 (113.0)
</td>
<td style="text-align:left;">
109.4 (41.3)
</td>
<td style="text-align:left;">
468.8 (130.9)
</td>
<td style="text-align:left;">
303.1 (161.8)
</td>
<td style="text-align:left;">
231.2 (61.7)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
184.4 (123.9)
</td>
<td style="text-align:left;">
96.9 (41.3)
</td>
<td style="text-align:left;">
462.5 (127.1)
</td>
<td style="text-align:left;">
303.1 (161.8)
</td>
<td style="text-align:left;">
228.1 (56.2)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
25.9 (3.4)
</td>
<td style="text-align:left;">
23.7 (4.8)
</td>
<td style="text-align:left;">
24.1 (1.9)
</td>
<td style="text-align:left;">
23.4 (4.5)
</td>
<td style="text-align:left;">
26.8 (5.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
29.9 (4.1)
</td>
<td style="text-align:left;">
28.5 (4.4)
</td>
<td style="text-align:left;">
24.3 (2.3)
</td>
<td style="text-align:left;">
25.3 (5.5)
</td>
<td style="text-align:left;">
26.8 (5.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
35.0 (4.8)
</td>
<td style="text-align:left;">
31.2 (2.6)
</td>
<td style="text-align:left;">
27.1 (2.1)
</td>
<td style="text-align:left;">
28.1 (5.9)
</td>
<td style="text-align:left;">
29.1 (5.7)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
40.4 (5.6)
</td>
<td style="text-align:left;">
34.7 (3.4)
</td>
<td style="text-align:left;">
30.0 (2.1)
</td>
<td style="text-align:left;">
31.0 (5.9)
</td>
<td style="text-align:left;">
31.8 (5.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
19.8 (2.1)
</td>
<td style="text-align:left;">
19.8 (1.5)
</td>
<td style="text-align:left;">
18.0 (1.1)
</td>
<td style="text-align:left;">
17.8 (1.8)
</td>
<td style="text-align:left;">
18.0 (1.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
19.7 (2.0)
</td>
<td style="text-align:left;">
19.8 (1.5)
</td>
<td style="text-align:left;">
18.2 (1.0)
</td>
<td style="text-align:left;">
18.2 (2.0)
</td>
<td style="text-align:left;">
18.1 (1.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
21.3 (2.7)
</td>
<td style="text-align:left;">
21.9 (1.3)
</td>
<td style="text-align:left;">
20.0 (0.9)
</td>
<td style="text-align:left;">
20.2 (2.1)
</td>
<td style="text-align:left;">
19.5 (1.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
22.3 (3.8)
</td>
<td style="text-align:left;">
22.8 (1.5)
</td>
<td style="text-align:left;">
21.5 (1.1)
</td>
<td style="text-align:left;">
21.9 (2.5)
</td>
<td style="text-align:left;">
21.2 (3.2)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
29.5 (23.6)
</td>
<td style="text-align:left;">
14.9 (1.6)
</td>
<td style="text-align:left;">
26.4 (10.1)
</td>
<td style="text-align:left;">
19.2 (17.1)
</td>
<td style="text-align:left;">
13.6 (6.1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
18.4 (13.2)
</td>
<td style="text-align:left;">
9.4 (2.7)
</td>
<td style="text-align:left;">
22.9 (7.5)
</td>
<td style="text-align:left;">
17.0 (15.4)
</td>
<td style="text-align:left;">
13.6 (6.1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
21.7 (16.1)
</td>
<td style="text-align:left;">
8.6 (4.0)
</td>
<td style="text-align:left;">
27.2 (8.5)
</td>
<td style="text-align:left;">
20.1 (16.9)
</td>
<td style="text-align:left;">
15.7 (7.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
26.9 (23.0)
</td>
<td style="text-align:left;">
9.3 (4.8)
</td>
<td style="text-align:left;">
32.7 (9.9)
</td>
<td style="text-align:left;">
24.1 (19.3)
</td>
<td style="text-align:left;">
18.7 (8.3)
</td>
</tr>
</tbody>
</table>
</div>
<div id="douglas-fir" class="section level2">
<h2>Douglas-fir</h2>
<pre class="r"><code>get_measures(species = &quot;PSMEM&quot;) %&gt;%
  make_summary() %&gt;%
  kableExtra::kbl() %&gt;%
  kableExtra::kable_classic(full_width = FALSE, html_font = &quot;Garamond&quot;) %&gt;%
  kableExtra::add_header_above(c(&quot; &quot; = 2, &quot;Treatment&quot; = 5)) %&gt;%
  kableExtra::collapse_rows(columns = 1, valign = &quot;top&quot;)</code></pre>
<table class=" lightable-classic" style="font-family: Garamond; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;" colspan="2">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Treatment
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
measure
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
C40
</th>
<th style="text-align:left;">
L40
</th>
<th style="text-align:left;">
C80
</th>
<th style="text-align:left;">
L80
</th>
<th style="text-align:left;">
Control
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
1037.5 (400.5)
</td>
<td style="text-align:left;">
1278.1 (92.6)
</td>
<td style="text-align:left;">
968.8 (235.7)
</td>
<td style="text-align:left;">
1312.5 (332.6)
</td>
<td style="text-align:left;">
1212.5 (264.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
250.0 (126.7)
</td>
<td style="text-align:left;">
256.2 (46.2)
</td>
<td style="text-align:left;">
725.0 (161.4)
</td>
<td style="text-align:left;">
728.1 (246.3)
</td>
<td style="text-align:left;">
1212.5 (264.4)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
218.8 (123.1)
</td>
<td style="text-align:left;">
240.6 (47.2)
</td>
<td style="text-align:left;">
575.0 (133.9)
</td>
<td style="text-align:left;">
693.8 (225.8)
</td>
<td style="text-align:left;">
996.9 (153.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Density (stems ha<sup>-1</sup>)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
196.9 (100.2)
</td>
<td style="text-align:left;">
234.4 (43.8)
</td>
<td style="text-align:left;">
503.1 (95.4)
</td>
<td style="text-align:left;">
656.2 (231.5)
</td>
<td style="text-align:left;">
740.6 (90.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
23.4 (2.9)
</td>
<td style="text-align:left;">
23.2 (1.1)
</td>
<td style="text-align:left;">
23.5 (2.0)
</td>
<td style="text-align:left;">
21.4 (1.6)
</td>
<td style="text-align:left;">
22.4 (1.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
27.0 (3.4)
</td>
<td style="text-align:left;">
32.4 (2.0)
</td>
<td style="text-align:left;">
23.5 (2.3)
</td>
<td style="text-align:left;">
25.2 (2.4)
</td>
<td style="text-align:left;">
22.4 (1.3)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
31.7 (3.8)
</td>
<td style="text-align:left;">
36.5 (1.8)
</td>
<td style="text-align:left;">
27.2 (2.9)
</td>
<td style="text-align:left;">
27.5 (2.7)
</td>
<td style="text-align:left;">
25.0 (1.0)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mean QMD (cm)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
35.8 (3.8)
</td>
<td style="text-align:left;">
40.6 (2.0)
</td>
<td style="text-align:left;">
30.0 (3.0)
</td>
<td style="text-align:left;">
29.9 (3.4)
</td>
<td style="text-align:left;">
28.7 (1.1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
23.2 (0.5)
</td>
<td style="text-align:left;">
24.1 (1.1)
</td>
<td style="text-align:left;">
22.0 (1.1)
</td>
<td style="text-align:left;">
21.8 (1.2)
</td>
<td style="text-align:left;">
22.8 (0.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
23.2 (0.5)
</td>
<td style="text-align:left;">
24.1 (1.1)
</td>
<td style="text-align:left;">
22.0 (1.1)
</td>
<td style="text-align:left;">
21.8 (1.2)
</td>
<td style="text-align:left;">
22.8 (0.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
24.8 (0.5)
</td>
<td style="text-align:left;">
26.3 (1.1)
</td>
<td style="text-align:left;">
24.3 (1.0)
</td>
<td style="text-align:left;">
24.0 (1.5)
</td>
<td style="text-align:left;">
24.1 (0.7)
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
26.9 (0.7)
</td>
<td style="text-align:left;">
28.3 (0.9)
</td>
<td style="text-align:left;">
26.2 (1.1)
</td>
<td style="text-align:left;">
26.2 (1.7)
</td>
<td style="text-align:left;">
25.5 (0.9)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
42.5 (7.3)
</td>
<td style="text-align:left;">
53.8 (2.0)
</td>
<td style="text-align:left;">
40.8 (3.6)
</td>
<td style="text-align:left;">
46.1 (7.0)
</td>
<td style="text-align:left;">
47.5 (7.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
08
</td>
<td style="text-align:left;">
14.0 (5.7)
</td>
<td style="text-align:left;">
21.0 (2.3)
</td>
<td style="text-align:left;">
30.7 (1.7)
</td>
<td style="text-align:left;">
35.1 (6.8)
</td>
<td style="text-align:left;">
47.5 (7.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
16.6 (7.0)
</td>
<td style="text-align:left;">
25.0 (3.7)
</td>
<td style="text-align:left;">
32.5 (1.2)
</td>
<td style="text-align:left;">
39.9 (7.3)
</td>
<td style="text-align:left;">
48.9 (6.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Basal area (m<sup>2</sup>/ha)
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
19.1 (7.2)
</td>
<td style="text-align:left;">
30.0 (3.7)
</td>
<td style="text-align:left;">
34.8 (0.6)
</td>
<td style="text-align:left;">
44.1 (7.8)
</td>
<td style="text-align:left;">
48.0 (5.7)
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="figures" class="section level1">
<h1>Figures</h1>
<p><img src="06_summary_files/figure-html/unnamed-chunk-17-1.png" width="687.36" /></p>
</div>
<div id="species-dominance" class="section level1">
<h1>Species dominance</h1>
<p>I’m interested in creating a measure of species dominance. I will select the 4 largest trees per plot and then determine what proportion of these are from each species. I will only consider and report on RW and DF. I could augment this by showing the average size of the dominant tree by species.</p>
<p>For this two function, the four highest ranking trees (height, growth, or diameter) were selected from each plot these were aggregated at the treatment level to determine the proportion of dominant trees in each species.</p>
<p>If I want to do hypothesis testing, I need to have two datasets, one of the raw data (counts of trees per plot) and one of the average proportion. I may want to do this with all of my metrics. The final aggregation may be able to be done with a single function, depending on how data were aggregated for each metric. Qmd is the only metric where the mean is not straight forward, as it is the square root of the mean of squared diameters.</p>
<p>For this to make sense for heights, we will need to predict heights for missing trees because the largest trees are missing heights in many cases.</p>
<p>Although I refer to proportions here, this is of 100 TPH, so multiplying by 100 gives TPH.</p>
<pre class="r"><code>spp_dom_raw &lt;- function(data = d_l, metrics = NULL, years = NULL) {
  if(is.null(years)) years &lt;- c(&quot;08&quot;, &quot;13&quot;, &quot;18&quot;)
  if(is.null(metrics)) metrics &lt;- c(&quot;dbh&quot;, &quot;ht_p&quot;, &quot;ba_inc2&quot;)
  raw &lt;- data %&gt;%
    filter(
      spp %in% c(&quot;SESE3&quot;, &quot;PSMEM&quot;),
      live | status %in% c(15, 16),
      year %in% years
    ) %&gt;%
    select(year, treatment, spp, plot, all_of(metrics)) %&gt;%
    pivot_longer(cols = all_of(metrics), names_to = &quot;measure&quot;) %&gt;%
    group_by(measure, year, treatment, plot) %&gt;%
    slice_max(order_by = value, n = 8, with_ties = FALSE) %&gt;%
    ungroup()
  missing &lt;- raw$measure[raw$value == 0 | is.na(raw$value)]
  if(length(missing) &gt; 0) {
    message &lt;- &quot;Measures missing values (entries removed):&quot;
    warning(paste(message, toString(unique(missing))))
  }
  filter(raw, value != 0)
}

spp_dom_cnt &lt;- function(...) {
  spp_dom_raw(...) %&gt;%
  count(measure, year, treatment, plot, spp) %&gt;%
  ungroup() %&gt;%
  complete(nesting(treatment, year, plot), spp, measure, fill = list(n = 0))
}

spp_dom_pct &lt;- function(...) {
  spp_dom_cnt(...) %&gt;%
    group_by(measure, treatment, year, spp) %&gt;%
    summarise(n = sum(n)) %&gt;%
    mutate(freq = n / sum(n)) %&gt;%
    arrange(measure, treatment, spp, year) %&gt;%
    ungroup()
}</code></pre>
<div id="dominance-figure" class="section level2">
<h2>Dominance figure</h2>
<pre class="r"><code>dominance_labels &lt;- as_labeller(
  c(
    ba_inc2 = &quot;BAI&quot;,
    dbh = &quot;dbh&quot;,
    ht_p = &quot;Height&quot;
  ),
  label_parsed
)

make_dominance_fig &lt;- function(...) {
  spp_dom_pct(...) %&gt;%
    relevel_treatment() %&gt;%
    mutate(measure = factor(measure, levels = c(&quot;dbh&quot;, &quot;ht_p&quot;, &quot;ba_inc2&quot;))) %&gt;%
    ggplot(aes(year, freq, fill = spp)) +
      geom_bar(position = &quot;stack&quot;, stat = &quot;identity&quot;) +
      facet_grid(
        vars(measure),
        vars(treatment),
        labeller = labeller(measure = dominance_labels)
      ) +
      theme_bw() +
      theme(
        panel.spacing.x = unit(1.3, &quot;mm&quot;),
        legend.position = &quot;bottom&quot;,
        legend.title = element_blank(),
        legend.key.size = unit(4, &quot;mm&quot;),
        legend.box.spacing = element_blank(),
        panel.grid = element_blank(),
        # strip.background.y = element_blank(),
        strip.placement = &quot;outside&quot;,
        axis.text.x = element_text(angle = 90, vjust = 0.25)
      ) +
      # scale_x_continuous(breaks = yr_breaks) +
      scale_y_continuous(breaks = c(0, .5, 1)) +
      scale_fill_manual(&quot;spp&quot;,
       values = c(SESE3 = &quot;black&quot;, PSMEM = &quot;#a0a0a0&quot;),
       labels = c(&quot;redwood&quot;, &quot;Douglas-fir&quot;)
      ) +
      labs(y = &quot;Proportion&quot;, x = &quot;Year&quot;)
}

make_dominance_fig(years = c(&quot;init&quot;, &quot;08&quot;, &quot;13&quot;, &quot;18&quot;))</code></pre>
<pre><code>## Warning in spp_dom_raw(...): Measures missing values (entries removed): ba_inc2</code></pre>
<pre><code>## Warning: Removed 20 rows containing missing values (position_stack).</code></pre>
<p><img src="06_summary_files/figure-html/unnamed-chunk-19-1.png" width="334.08" /></p>
<pre class="r"><code>ggsave(
  filename = &quot;figs/dominance_fig.pdf&quot;,
  device = cairo_pdf,
  width = 8.84,
  height = 8,
  units = &quot;cm&quot;
)</code></pre>
<pre><code>## Warning: Removed 20 rows containing missing values (position_stack).</code></pre>
<pre class="r"><code>ggsave(
  filename = &quot;figs/dominance_fig.jpg&quot;,
  width = 8.84,
  height = 8,
  units = &quot;cm&quot;
)</code></pre>
<pre><code>## Warning: Removed 20 rows containing missing values (position_stack).</code></pre>
<p>Now I need to display the average values for these dominant species, perhaps along with their standard deviations. I think I’ll just do this for each treatment in the most recent measurement period.</p>
</div>
<div id="species-dominance-significance-test" class="section level2">
<h2>Species dominance significance test</h2>
<p>A Wilcoxon rank-sum test could be used to test if one treatment results in changes that are significantly greater than another treatment. Unfortunately, it seems like none of the treatments that show an average increase in the number of dominant SESE are significant at the alpha = 0.05 level, using a 1-sided test. One-sided permutation tests shows even larger p-values, and these I would expect to be more accurate given the number of zeros in the data.</p>
<p>To start, I will only test significance for dbh ranked dominance, to see if treatment effect is significant there. first I get a list of differences from 2008 to 2018 for each plot in a treatment, this represents the treatments effect on redwood dominance. Then I compare the treatments to see is ones with a larger average effect, are significantly larger than those with a smaller average effect: 1-sided non-parametric tests. Wilcox rank-sum has lower p-values, than the permutation test. The data has a lot of zeros, and very few data points, none of the one-sided differences are significant. It is too soon to tell if redwood dominance has been affected.</p>
<pre class="r"><code># This is the permutation calculation

new_diff &lt;- function(d_null) {
  new_samp &lt;- sample(d_null)
  mean(new_samp[5:8]) - mean(new_samp[1:4])
}

perm_test &lt;- function(x, y, M = 1e5) {
  obs_diff &lt;- mean(x) - mean(y)
  d_null &lt;- c(x, y)
  perm_diff &lt;- replicate(M, new_diff(d_null))
  sum(perm_diff &gt;= obs_diff) / M
}

# Takes one of my dominance metrics: dbh, ht, ba_inc2

non_para_dom_test &lt;- function(metric) {
  # only 2013 and 2018 available for basal area increment
  if(metric == &quot;ba_inc2&quot;) years &lt;- c(&quot;13&quot;, &quot;18&quot;) else years &lt;- c(&quot;08&quot;, &quot;18&quot;)
  
  # summarize differences between 2018 and 2013 for each treatment
  # (plot differences)
  W1 &lt;- spp_dom_cnt(metrics = metric, years = years) %&gt;%
    filter(spp == &quot;SESE3&quot;) %&gt;%
    group_by(plot) %&gt;%
    mutate(diff = n - lag(n)) %&gt;%
    drop_na() %&gt;%
    ungroup() %&gt;%
    select(treatment, measure, diff)
    
  W &lt;- with(W1, split(diff, treatment))

  # Get all combinations of treatments, where average change of treatment 1
  # is greater than the average for treatment 2

  combos &lt;- W1 %&gt;%
    group_by(treatment, measure) %&gt;%
    nest_by() %&gt;%
    mutate(avg = map_dbl(data, mean)) %&gt;%
    expand_grid(a = ., b = .) %&gt;%
    mutate(diff = a$avg - b$avg) %&gt;%
    arrange(desc(diff)) %&gt;%
    filter(diff &gt; 0) %&gt;%
    transmute(treat.a = a$treatment, treat.b = b$treatment)
  
  print(paste0(&quot;Test for &quot;, metric, &quot;:&quot;))

  apply(combos, 1, function(x) {
    wilout &lt;- wilcox.test(W[[ x[1] ]], W[[ x[2] ]], alternative = &quot;g&quot;)
    permout &lt;- perm_test(W[[ x[1] ]], W[[ x[2] ]])
    list(test = paste(x[1], &quot;&gt;&quot;, x[2]), Wilcox.P = wilout$p.value, Perm.P = permout)  
  }) %&gt;%
    bind_rows()
}</code></pre>
<pre class="r"><code>non_para_dom_test(&quot;dbh&quot;)</code></pre>
<pre><code>## [1] &quot;Test for dbh:&quot;</code></pre>
<pre><code>## # A tibble: 8 x 3
##   test      Wilcox.P Perm.P
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
## 1 H80 &gt; L40   0.0668  0.142
## 2 L80 &gt; L40   0.0668  0.143
## 3 C &gt; L40     0.310   0.285
## 4 H40 &gt; L40   0.128   0.287
## 5 H80 &gt; C     0.321   0.503
## 6 H80 &gt; H40   0.304   0.499
## 7 L80 &gt; C     0.321   0.499
## 8 L80 &gt; H40   0.304   0.498</code></pre>
<pre class="r"><code>non_para_dom_test(&quot;ba_inc2&quot;)</code></pre>
<pre><code>## [1] &quot;Test for ba_inc2:&quot;</code></pre>
<pre><code>## # A tibble: 9 x 3
##   test      Wilcox.P Perm.P
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
## 1 C &gt; L40     0.0235 0.0430
## 2 L80 &gt; L40   0.0443 0.0856
## 3 H80 &gt; L40   0.0432 0.0861
## 4 C &gt; H40     0.103  0.187 
## 5 L80 &gt; H40   0.176  0.241 
## 6 H40 &gt; L40   0.215  0.327 
## 7 H80 &gt; H40   0.215  0.329 
## 8 C &gt; H80     0.304  0.500 
## 9 L80 &gt; H80   0.437  0.499</code></pre>
<pre class="r"><code>non_para_dom_test(&quot;ht&quot;)</code></pre>
<pre><code>## [1] &quot;Test for ht:&quot;</code></pre>
<pre><code>## # A tibble: 10 x 3
##    test      Wilcox.P Perm.P
##    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
##  1 L80 &gt; H40   0.0316 0.0574
##  2 C &gt; H40     0.0902 0.100 
##  3 L80 &gt; L40   0.0671 0.0990
##  4 H80 &gt; H40   0.178  0.199 
##  5 L80 &gt; H80   0.231  0.213 
##  6 C &gt; L40     0.224  0.242 
##  7 L40 &gt; H40   0.5    0.301 
##  8 L80 &gt; C     0.221  0.297 
##  9 C &gt; H80     0.385  0.429 
## 10 H80 &gt; L40   0.385  0.429</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
