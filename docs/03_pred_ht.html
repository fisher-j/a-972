<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>03_pred_ht.knit</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">A-972 10-year Study</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="01_import.html">Data import</a>
</li>
<li>
  <a href="02_data_cleaning.html">Data cleaning</a>
</li>
<li>
  <a href="03_pred_ht.html">Predicting missing heights</a>
</li>
<li>
  <a href="04_define.html">Define new variables</a>
</li>
<li>
  <a href="05_summary.html">Data summaries and figures</a>
</li>
<li>
  <a href="06_variability.html">Variability</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>

<div id="TOC">
<ul>
<li><a href="#predicting-missing-heights">Predicting missing heights</a></li>
<li><a href="#non-linear-height-dbh-model">Non-linear height-dbh model</a></li>
</ul>
</div>

<div id="predicting-missing-heights" class="section level3">
<h3>Predicting missing heights</h3>
<p>It might be important to fill in missing heights (especially for dominant trees) in 2018. First I’ll explore a simple linear relationship between dbh and height increment. I’m only looking at live, unbroken redwood and Douglas-fir.</p>
<pre class="r"><code>test_d &lt;- d_l %&gt;%
  # add increment data
  group_by(tree_id) %&gt;%
  mutate(
    ht_inc_2 = nth(lead(ht) - ht, 3, order_by = year) / 5,
    ht_inc_1 = nth(lead(ht) - ht, 2, order_by = year) / 5,
    ht_13 = nth(ht, 3, order_by = year)) %&gt;%
  # only use unbroken live sese or psme from 2018
  filter(
    spp %in% c(&quot;SESE3&quot;, &quot;PSMEM&quot;),
    year == &quot;18&quot;,
    status == 1,
    !get_cond(2, 3)
  ) %&gt;%
  ungroup()
  
# fit model to each group to generate lables for plot
plot_groups &lt;- function(
  group = treatment,
  response = ht_inc_2,
  predictor = dbh,
  by_spp = TRUE,
  title,
  pred = FALSE
  ) {
  palette(&quot;Tableau 10&quot;)
  x &lt;- substitute(predictor)
  y &lt;- substitute(response)
  form &lt;- formula(bquote(.(y) ~ .(x)))
  if (by_spp) {
    dat &lt;- group_by(test_d, group = {{group}}, spp)
  } else {
    dat &lt;- group_by(test_d, group = {{group}})
  }
  mytext &lt;- dat %&gt;%
    summarize(lm_eqn(lm(form, data = cur_data())))
  if (by_spp) {
    mytext &lt;- pivot_longer(mytext, !c(group, spp)) %&gt;%
    arrange(group, name) %&gt;%
    mutate(
      x = npc(dat[[x]], c(0, 0, .7, .7, .7, .7)),
      y = npc(dat[[y]], c(1.1, 1, .1, 0, 1.1, 1))
    )
  } else {
    mytext &lt;- pivot_longer(mytext, !c(group)) %&gt;%
    arrange(group, name) %&gt;%
    group_by(group) %&gt;%
    mutate(
      x = npc(dat[[x]], c(0, .7, .7)),
      y = npc(dat[[y]], c(1.1,.1,1.1))
    )
  }
  # Plot based on specified group and species (if indicated)
  p &lt;- if (by_spp) {
    ggplot(
      dat,
      aes(x = {{predictor}},
      y = {{response}},
      fill = spp,
      color = spp)
    )
  } else {
    ggplot(dat, aes(x = {{predictor}}, y = {{response}}))
  }
  print(p +
      geom_point(size = 1.3, shape = 16, alpha = .6) +
      geom_smooth(method = &quot;lm&quot;, alpha = .25) +
      facet_wrap(~ group) +
      geom_text(
        data = mytext,
        aes(x = x, y = y, label = value, hjust = 0),
        parse = TRUE,
        family = &quot;mono&quot;,
        fontface = &quot;bold&quot;
      ) +
      labs(title = title) +
      theme_bw() +
      scale_color_manual(
        values = palette(),
        aesthetics = c(&quot;color&quot;, &quot;fill&quot;)) +
      guides(fill = guide_legend(override.aes = aes(label = &quot;&quot;))) +
      if(pred == TRUE) {
        geom_point(data = miss, aes(color = spp), shape = 16)
      }
  )
}</code></pre>
<p>Out of these models, the H40, H80 and L80 have a p &lt; 0.05. In none of them is there a significant difference in slope (between species). Constants are significantly different for H40, L80.</p>
<pre class="r"><code>plot_groups(title = &quot;Height increment vs dbh&quot;)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-2-1.png" width="1008" /></p>
<pre class="r"><code>library(broom)

get_model_stats &lt;- function(formula, grouping) {
  test_d %&gt;% 
    nest_by(group = {{grouping}}) %&gt;%
    mutate(
      mod = list(lm(formula, data = data)),
      summary = list(tidy(mod)),
      pf = pf(
        summary(mod)$fstatistic[1],
        summary(mod)$fstatistic[2],
        summary(mod)$fstatistic[3],
        lower.tail = FALSE
      )
    ) %&gt;%
    unnest(summary) %&gt;%
    select(-c(data, mod))
}</code></pre>
<pre class="r"><code>stat &lt;- get_model_stats(formula = ht_inc_2 ~ dbh * spp, grouping = treatment)
stat %&gt;%
  color_groups() %&gt;%
  row_spec(which(stat$p.value &lt; .05), background = &quot;MistyRose&quot;)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
</caption>
<thead>
<tr>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
pf
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.1375585
</td>
<td style="text-align:right;">
0.1143752
</td>
<td style="text-align:right;">
1.2026948
</td>
<td style="text-align:right;">
0.2315864
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dbh
</td>
<td style="text-align:right;">
0.0068448
</td>
<td style="text-align:right;">
0.0039640
</td>
<td style="text-align:right;">
1.7267242
</td>
<td style="text-align:right;">
0.0869259
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
sppSESE3
</td>
<td style="text-align:right;">
-0.0287703
</td>
<td style="text-align:right;">
0.1903294
</td>
<td style="text-align:right;">
-0.1511608
</td>
<td style="text-align:right;">
0.8801160
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dbh:sppSESE3
</td>
<td style="text-align:right;">
-0.0013134
</td>
<td style="text-align:right;">
0.0057836
</td>
<td style="text-align:right;">
-0.2270885
</td>
<td style="text-align:right;">
0.8207616
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
(Intercept)
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1996656
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.2169151
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.9204782
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.3607796
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0449821
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
dbh
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0064417
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0058014
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
1.1103671
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.2709953
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0449821
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.2510704
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.2910948
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.8625040
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.3916307
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0449821
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
dbh:sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0009350
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0073355
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1274625
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.8989740
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0449821
</td>
</tr>
<tr>
<td style="text-align:left;">
H80
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-0.0468195
</td>
<td style="text-align:right;">
0.1287197
</td>
<td style="text-align:right;">
-0.3637320
</td>
<td style="text-align:right;">
0.7165101
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
H80
</td>
<td style="text-align:left;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0137452
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0042626
</td>
<td style="text-align:right;background-color: MistyRose !important;">
3.2246324
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0015126
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
H80
</td>
<td style="text-align:left;">
sppSESE3
</td>
<td style="text-align:right;">
-0.0746243
</td>
<td style="text-align:right;">
0.1507183
</td>
<td style="text-align:right;">
-0.4951240
</td>
<td style="text-align:right;">
0.6211519
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
H80
</td>
<td style="text-align:left;">
dbh:sppSESE3
</td>
<td style="text-align:right;">
-0.0007062
</td>
<td style="text-align:right;">
0.0048376
</td>
<td style="text-align:right;">
-0.1459815
</td>
<td style="text-align:right;">
0.8841089
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
L40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
(Intercept)
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.5103101
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.4361034
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
1.1701586
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.2485344
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.6484228
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
L40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
dbh
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.0035253
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0112579
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.3131379
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.7557257
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.6484228
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
L40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.2881778
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.5279011
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.5458936
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.5880271
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.6484228
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
L40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
dbh:sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0042670
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0137433
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.3104809
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.7577309
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.6484228
</td>
</tr>
<tr>
<td style="text-align:left;">
L80
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.1008937
</td>
<td style="text-align:right;">
0.1181852
</td>
<td style="text-align:right;">
0.8536919
</td>
<td style="text-align:right;">
0.3957934
</td>
<td style="text-align:right;">
0.0000002
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
L80
</td>
<td style="text-align:left;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0114392
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0038244
</td>
<td style="text-align:right;background-color: MistyRose !important;">
2.9911383
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0036814
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000002
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
L80
</td>
<td style="text-align:left;background-color: MistyRose !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: MistyRose !important;">
-0.3457901
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.1671822
</td>
<td style="text-align:right;background-color: MistyRose !important;">
-2.0683429
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0417983
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000002
</td>
</tr>
<tr>
<td style="text-align:left;">
L80
</td>
<td style="text-align:left;">
dbh:sppSESE3
</td>
<td style="text-align:right;">
0.0071266
</td>
<td style="text-align:right;">
0.0050994
</td>
<td style="text-align:right;">
1.3975317
</td>
<td style="text-align:right;">
0.1660699
</td>
<td style="text-align:right;">
0.0000002
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>stat &lt;- get_model_stats(formula = ht_inc_2 ~ dbh + spp, grouping = treatment)
stat %&gt;%
  color_groups() %&gt;%
  row_spec(which(stat$p.value &lt; .05), background = &quot;MistyRose&quot;)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
</caption>
<thead>
<tr>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
pf
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.1545358
</td>
<td style="text-align:right;">
0.0862016
</td>
<td style="text-align:right;">
1.7927252
</td>
<td style="text-align:right;">
0.0756458
</td>
<td style="text-align:right;">
0.0893222
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
C
</td>
<td style="text-align:left;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0062278
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0028746
</td>
<td style="text-align:right;background-color: MistyRose !important;">
2.1665172
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0323351
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0893222
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
sppSESE3
</td>
<td style="text-align:right;">
-0.0687429
</td>
<td style="text-align:right;">
0.0720991
</td>
<td style="text-align:right;">
-0.9534507
</td>
<td style="text-align:right;">
0.3423616
</td>
<td style="text-align:right;">
0.0893222
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
(Intercept)
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1785928
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1393595
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
1.2815257
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.2045619
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0174456
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
dbh
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0070266
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0035234
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
1.9942599
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0503214
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0174456
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
H40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
-0.2156331
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0856009
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
-2.5190530
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0142360
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0174456
</td>
</tr>
<tr>
<td style="text-align:left;">
H80
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-0.0308234
</td>
<td style="text-align:right;">
0.0673480
</td>
<td style="text-align:right;">
-0.4576736
</td>
<td style="text-align:right;">
0.6477679
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
H80
</td>
<td style="text-align:left;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0131969
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0020099
</td>
<td style="text-align:right;background-color: MistyRose !important;">
6.5660360
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000000
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
H80
</td>
<td style="text-align:left;">
sppSESE3
</td>
<td style="text-align:right;">
-0.0954426
</td>
<td style="text-align:right;">
0.0486307
</td>
<td style="text-align:right;">
-1.9625991
</td>
<td style="text-align:right;">
0.0513152
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
L40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
(Intercept)
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.4001717
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.2509921
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
1.5943596
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1181804
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.4561967
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
L40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
dbh
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.0006620
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0063890
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.1036192
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.9179533
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.4561967
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
L40
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.1273662
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1009696
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-1.2614302
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.2139544
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.4561967
</td>
</tr>
<tr>
<td style="text-align:left;">
L80
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-0.0184106
</td>
<td style="text-align:right;">
0.0822052
</td>
<td style="text-align:right;">
-0.2239594
</td>
<td style="text-align:right;">
0.8233460
</td>
<td style="text-align:right;">
0.0000001
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
L80
</td>
<td style="text-align:left;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0154475
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0025444
</td>
<td style="text-align:right;background-color: MistyRose !important;">
6.0711651
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000000
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000001
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
L80
</td>
<td style="text-align:left;background-color: MistyRose !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: MistyRose !important;">
-0.1242865
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0534947
</td>
<td style="text-align:right;background-color: MistyRose !important;">
-2.3233436
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0226379
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0000001
</td>
</tr>
</tbody>
</table>
<p>Now I’m combining treatments so we only have a C, H, and L. Again slopes are not significantly different and neither are constants between species.</p>
<pre class="r"><code># Now I&#39;ll combine treatments so we just have a H, L and C
plot_groups(str_extract(treatment, &quot;C|H|L&quot;), title = &quot;Height increment vs dbh&quot;)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-5-1.png" width="1008" /></p>
<pre class="r"><code># do ancova, look at interaction first and then see if 
# y-intercepts are any different between models.

stat &lt;- get_model_stats(
  formula = ht_inc_2 ~ dbh * spp,
  grouping = str_extract(treatment, &quot;C|L|H&quot;))
stat %&gt;%
  color_groups() %&gt;%
  row_spec(which(stat$p.value &lt; .05), background = &quot;MistyRose&quot;)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
</caption>
<thead>
<tr>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
pf
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.1375585
</td>
<td style="text-align:right;">
0.1143752
</td>
<td style="text-align:right;">
1.2026948
</td>
<td style="text-align:right;">
0.2315864
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dbh
</td>
<td style="text-align:right;">
0.0068448
</td>
<td style="text-align:right;">
0.0039640
</td>
<td style="text-align:right;">
1.7267242
</td>
<td style="text-align:right;">
0.0869259
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
sppSESE3
</td>
<td style="text-align:right;">
-0.0287703
</td>
<td style="text-align:right;">
0.1903294
</td>
<td style="text-align:right;">
-0.1511608
</td>
<td style="text-align:right;">
0.8801160
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dbh:sppSESE3
</td>
<td style="text-align:right;">
-0.0013134
</td>
<td style="text-align:right;">
0.0057836
</td>
<td style="text-align:right;">
-0.2270885
</td>
<td style="text-align:right;">
0.8207616
</td>
<td style="text-align:right;">
0.1822137
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
(Intercept)
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0352369
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1044112
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.3374822
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.7360509
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
H
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0109561
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0032260
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
3.3962175
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0008005
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.1157410
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.1273125
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.9091092
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.3642122
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
dbh:sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.0005100
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0037783
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
-0.1349888
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.8927348
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
L
</td>
<td style="text-align:left;background-color: MistyRose !important;">
(Intercept)
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.2612637
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.1187382
</td>
<td style="text-align:right;background-color: MistyRose !important;">
2.2003339
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0295917
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0002230
</td>
</tr>
<tr>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
dbh
</td>
<td style="text-align:right;">
0.0046595
</td>
<td style="text-align:right;">
0.0034776
</td>
<td style="text-align:right;">
1.3398659
</td>
<td style="text-align:right;">
0.1826814
</td>
<td style="text-align:right;">
0.0002230
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
L
</td>
<td style="text-align:left;background-color: MistyRose !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: MistyRose !important;">
-0.3908625
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.1698028
</td>
<td style="text-align:right;background-color: MistyRose !important;">
-2.3018619
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0229711
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0002230
</td>
</tr>
<tr>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
dbh:sppSESE3
</td>
<td style="text-align:right;">
0.0090246
</td>
<td style="text-align:right;">
0.0048554
</td>
<td style="text-align:right;">
1.8586824
</td>
<td style="text-align:right;">
0.0653870
</td>
<td style="text-align:right;">
0.0002230
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>stat &lt;- get_model_stats(
  formula = ht_inc_2 ~ dbh + spp,
  grouping = str_extract(treatment, &quot;C|L|H&quot;))
stat %&gt;%
  color_groups() %&gt;%
  row_spec(which(stat$p.value &lt; .05), background = &quot;MistyRose&quot;)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
</caption>
<thead>
<tr>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
pf
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.1545358
</td>
<td style="text-align:right;">
0.0862016
</td>
<td style="text-align:right;">
1.7927252
</td>
<td style="text-align:right;">
0.0756458
</td>
<td style="text-align:right;">
0.0893222
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
C
</td>
<td style="text-align:left;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0062278
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0028746
</td>
<td style="text-align:right;background-color: MistyRose !important;">
2.1665172
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0323351
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0893222
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
sppSESE3
</td>
<td style="text-align:right;">
-0.0687429
</td>
<td style="text-align:right;">
0.0720991
</td>
<td style="text-align:right;">
-0.9534507
</td>
<td style="text-align:right;">
0.3423616
</td>
<td style="text-align:right;">
0.0893222
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;">
H
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;">
(Intercept)
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0467957
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0596232
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.7848574
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.4333145
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
H
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0105843
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0016760
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
6.3152784
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0000000
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
H
</td>
<td style="text-align:left;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
sppSESE3
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
-0.1319313
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0426110
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
-3.0961822
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0021943
</td>
<td style="text-align:right;background-color: #EEE9E9 !important;background-color: MistyRose !important;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.1079034
</td>
<td style="text-align:right;">
0.0862012
</td>
<td style="text-align:right;">
1.2517623
</td>
<td style="text-align:right;">
0.2129392
</td>
<td style="text-align:right;">
0.0003239
</td>
</tr>
<tr>
<td style="text-align:left;background-color: MistyRose !important;">
L
</td>
<td style="text-align:left;background-color: MistyRose !important;">
dbh
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0092890
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0024500
</td>
<td style="text-align:right;background-color: MistyRose !important;">
3.7914141
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0002297
</td>
<td style="text-align:right;background-color: MistyRose !important;">
0.0003239
</td>
</tr>
<tr>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
sppSESE3
</td>
<td style="text-align:right;">
-0.0893818
</td>
<td style="text-align:right;">
0.0507159
</td>
<td style="text-align:right;">
-1.7623995
</td>
<td style="text-align:right;">
0.0803888
</td>
<td style="text-align:right;">
0.0003239
</td>
</tr>
</tbody>
</table>
<p>I’ll look at what happens if I group by treatment intensity instead. Again, this does not seem to reveal any especially significant</p>
<pre class="r"><code># for comparison I&#39;ll combine treatment intensities instead
plot_groups(str_extract(treatment, &quot;C|40|80&quot;), title = &quot;Height increment vs dbh&quot;)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-7-1.png" width="1008" /></p>
<p>Perhaps a height model that includes more predictors would reveal a difference in response between treatments, our current models are not capturing much variance. I had the thought that we already have height data for our trees, shouldn’t that be a pretty good predictor of height in the next period? For that matter, I can also use height_inc from period 1 and current dbh as well and vary these all by treatment.</p>
<p>I’ll start with a full model for height and then remove variables (or interactions of variables) based on AIC.</p>
<pre class="r"><code> mod1 &lt;- lm(ht ~ (ht_13 + ht_inc_1 + dbh) * treatment * spp, data = test_d)
summary(mod1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = ht ~ (ht_13 + ht_inc_1 + dbh) * treatment * spp, 
##     data = test_d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.4896 -0.8061  0.0552  0.8873  4.8686 
## 
## Coefficients:
##                                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                     5.01910    1.62435   3.090  0.00213 ** 
## ht_13                           0.74589    0.09559   7.803 4.47e-14 ***
## ht_inc_1                       -0.46414    0.45546  -1.019  0.30874    
## dbh                             0.10521    0.03238   3.249  0.00125 ** 
## treatmentH40                    4.24300    3.58843   1.182  0.23768    
## treatmentH80                   -5.76233    2.76028  -2.088  0.03741 *  
## treatmentL40                    3.94807    4.31142   0.916  0.36031    
## treatmentL80                   -7.84445    3.22317  -2.434  0.01534 *  
## sppSESE3                       -5.30221    2.21177  -2.397  0.01693 *  
## ht_13:treatmentH40             -0.20800    0.20446  -1.017  0.30958    
## ht_13:treatmentH80              0.31141    0.16195   1.923  0.05513 .  
## ht_13:treatmentL40             -0.06641    0.19094  -0.348  0.72815    
## ht_13:treatmentL80              0.45763    0.18775   2.437  0.01519 *  
## ht_inc_1:treatmentH40           0.89096    1.11251   0.801  0.42365    
## ht_inc_1:treatmentH80          -0.67477    0.82340  -0.819  0.41295    
## ht_inc_1:treatmentL40           1.77614    1.31896   1.347  0.17880    
## ht_inc_1:treatmentL80          -1.06393    1.05601  -1.008  0.31425    
## dbh:treatmentH40                0.01668    0.05446   0.306  0.75957    
## dbh:treatmentH80               -0.04845    0.04889  -0.991  0.32227    
## dbh:treatmentL40               -0.08461    0.07022  -1.205  0.22890    
## dbh:treatmentL80               -0.08478    0.05573  -1.521  0.12887    
## ht_13:sppSESE3                  0.31567    0.14735   2.142  0.03272 *  
## ht_inc_1:sppSESE3              -0.22055    0.94443  -0.234  0.81546    
## dbh:sppSESE3                   -0.08776    0.05026  -1.746  0.08152 .  
## treatmentH40:sppSESE3          -4.55168    4.08147  -1.115  0.26537    
## treatmentH80:sppSESE3           5.28467    3.27393   1.614  0.10721    
## treatmentL40:sppSESE3           4.86527    5.89491   0.825  0.40963    
## treatmentL80:sppSESE3           7.32883    4.13221   1.774  0.07682 .  
## ht_13:treatmentH40:sppSESE3     0.21419    0.25546   0.838  0.40223    
## ht_13:treatmentH80:sppSESE3    -0.34762    0.20865  -1.666  0.09641 .  
## ht_13:treatmentL40:sppSESE3    -0.53003    0.33452  -1.584  0.11382    
## ht_13:treatmentL80:sppSESE3    -0.55474    0.27849  -1.992  0.04700 *  
## ht_inc_1:treatmentH40:sppSESE3  0.96018    1.77084   0.542  0.58794    
## ht_inc_1:treatmentH80:sppSESE3  0.44578    1.28181   0.348  0.72818    
## ht_inc_1:treatmentL40:sppSESE3  3.10728    2.24920   1.382  0.16783    
## ht_inc_1:treatmentL80:sppSESE3  1.84212    1.72140   1.070  0.28515    
## dbh:treatmentH40:sppSESE3      -0.03005    0.07698  -0.390  0.69647    
## dbh:treatmentH80:sppSESE3       0.09475    0.06503   1.457  0.14581    
## dbh:treatmentL40:sppSESE3       0.13923    0.10571   1.317  0.18850    
## dbh:treatmentL80:sppSESE3       0.16998    0.08536   1.991  0.04708 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.516 on 439 degrees of freedom
##   (499 observations deleted due to missingness)
## Multiple R-squared:  0.9066, Adjusted R-squared:  0.8983 
## F-statistic: 109.2 on 39 and 439 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>It turns out the varying first period increment by spp and treatment lowers AIC, so I’ll pull it out of the interaction. Pulling out dbh or ht_13 don’t appear to result in any significant improvement in AIC.</p>
<pre class="r"><code>drop1(mod1)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## ht ~ (ht_13 + ht_inc_1 + dbh) * treatment * spp
##                        Df Sum of Sq    RSS    AIC
## &lt;none&gt;                              1009.5 437.11
## ht_13:treatment:spp     4   23.4902 1033.0 440.13
## ht_inc_1:treatment:spp  4    6.1674 1015.7 432.02
## dbh:treatment:spp       4   17.8964 1027.4 437.52</code></pre>
<pre class="r"><code>mod2 &lt;- lm(ht ~ (ht_13 + dbh) * treatment * spp  + ht_inc_1, data = test_d)
summary(mod2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = ht ~ (ht_13 + dbh) * treatment * spp + ht_inc_1, 
##     data = test_d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.4873 -0.8576  0.0384  0.9100  5.1691 
## 
## Coefficients:
##                              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                  5.051734   1.626162   3.107  0.00201 ** 
## ht_13                        0.742492   0.094224   7.880 2.51e-14 ***
## dbh                          0.106145   0.032173   3.299  0.00105 ** 
## treatmentH40                 2.842605   3.201220   0.888  0.37503    
## treatmentH80                -4.734739   2.600390  -1.821  0.06931 .  
## treatmentL40                 0.931693   3.768678   0.247  0.80485    
## treatmentL80                -6.362000   2.981355  -2.134  0.03339 *  
## sppSESE3                    -5.156896   2.156440  -2.391  0.01720 *  
## ht_inc_1                    -0.399346   0.246303  -1.621  0.10564    
## ht_13:treatmentH40          -0.111414   0.169761  -0.656  0.51197    
## ht_13:treatmentH80           0.236302   0.144466   1.636  0.10261    
## ht_13:treatmentL40           0.069153   0.165026   0.419  0.67538    
## ht_13:treatmentL80           0.364688   0.169119   2.156  0.03158 *  
## dbh:treatmentH40            -0.003325   0.049178  -0.068  0.94612    
## dbh:treatmentH80            -0.032630   0.046317  -0.704  0.48150    
## dbh:treatmentL40            -0.081496   0.070559  -1.155  0.24870    
## dbh:treatmentL80            -0.071917   0.054552  -1.318  0.18807    
## ht_13:sppSESE3               0.308109   0.143117   2.153  0.03186 *  
## dbh:sppSESE3                -0.088958   0.050384  -1.766  0.07815 .  
## treatmentH40:sppSESE3       -3.962350   3.695086  -1.072  0.28415    
## treatmentH80:sppSESE3        4.485905   3.073585   1.460  0.14513    
## treatmentL40:sppSESE3        3.043893   5.250048   0.580  0.56235    
## treatmentL80:sppSESE3        5.109685   3.722791   1.373  0.17058    
## ht_13:treatmentH40:sppSESE3  0.174761   0.225020   0.777  0.43778    
## ht_13:treatmentH80:sppSESE3 -0.299655   0.188995  -1.586  0.11355    
## ht_13:treatmentL40:sppSESE3 -0.354261   0.302401  -1.171  0.24202    
## ht_13:treatmentL80:sppSESE3 -0.393498   0.233740  -1.683  0.09298 .  
## dbh:treatmentH40:sppSESE3   -0.011574   0.073644  -0.157  0.87519    
## dbh:treatmentH80:sppSESE3    0.085725   0.062972   1.361  0.17410    
## dbh:treatmentL40:sppSESE3    0.136061   0.106431   1.278  0.20177    
## dbh:treatmentL80:sppSESE3    0.142046   0.078435   1.811  0.07081 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.529 on 448 degrees of freedom
##   (499 observations deleted due to missingness)
## Multiple R-squared:  0.9031, Adjusted R-squared:  0.8966 
## F-statistic: 139.1 on 30 and 448 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>drop1(mod2)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## ht ~ (ht_13 + dbh) * treatment * spp + ht_inc_1
##                     Df Sum of Sq    RSS    AIC
## &lt;none&gt;                           1047.4 436.75
## ht_inc_1             1    6.1461 1053.5 437.56
## ht_13:treatment:spp  4   19.5566 1067.0 437.62
## dbh:treatment:spp    4   14.3087 1061.7 435.25</code></pre>
<pre class="r"><code>miss &lt;- test_d %&gt;% filter(is.na(ht), across(c(dbh, ht_13, ht_inc_1), ~ !is.na(.)))
miss$ht &lt;- predict(mod2, miss)

plot(
  test_d$dbh,
  test_d$ht,
  main = paste(&quot;Predicted and recorded heights for 2018&quot;, format(formula(mod2)), sep = &quot;\n&quot;),
  xlab = &quot;dbh&quot;,
  ylab = &quot;Height&quot;
)
points(miss$dbh, miss$ht, col = &quot;indianred&quot;, pch = 16, cex = .8)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Testing another model. We have previous heights and previous increments, If I was going to predict heights by hand, that’s how I would do it.</p>
<pre class="r"><code>mod3 &lt;- lm(ht ~ ht_13*treatment*spp, data = test_d)
summary(mod3)</code></pre>
<pre><code>## 
## Call:
## lm(formula = ht ~ ht_13 * treatment * spp, data = test_d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.4943 -0.8998  0.0824  0.8832  5.8985 
## 
## Coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                  1.93177    1.37972   1.400   0.1621    
## ht_13                        0.98744    0.05689  17.358   &lt;2e-16 ***
## treatmentH40                 2.87739    2.91452   0.987   0.3240    
## treatmentH80                -3.36357    2.18882  -1.537   0.1250    
## treatmentL40                 5.11258    3.67753   1.390   0.1651    
## treatmentL80                -4.04905    2.48538  -1.629   0.1040    
## sppSESE3                    -2.10316    1.88339  -1.117   0.2647    
## ht_13:treatmentH40          -0.09260    0.11618  -0.797   0.4259    
## ht_13:treatmentH80           0.14269    0.08920   1.600   0.1104    
## ht_13:treatmentL40          -0.18567    0.14213  -1.306   0.1921    
## ht_13:treatmentL80           0.18876    0.10126   1.864   0.0629 .  
## ht_13:sppSESE3               0.08831    0.08120   1.088   0.2773    
## treatmentH40:sppSESE3       -3.78829    3.39842  -1.115   0.2655    
## treatmentH80:sppSESE3        1.91501    2.65115   0.722   0.4704    
## treatmentL40:sppSESE3       -1.98431    4.96603  -0.400   0.6896    
## treatmentL80:sppSESE3        1.09875    3.19967   0.343   0.7315    
## ht_13:treatmentH40:sppSESE3  0.12510    0.14039   0.891   0.3733    
## ht_13:treatmentH80:sppSESE3 -0.07228    0.11245  -0.643   0.5207    
## ht_13:treatmentL40:sppSESE3  0.03134    0.20760   0.151   0.8801    
## ht_13:treatmentL80:sppSESE3 -0.04142    0.13554  -0.306   0.7601    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.605 on 471 degrees of freedom
##   (487 observations deleted due to missingness)
## Multiple R-squared:  0.8891, Adjusted R-squared:  0.8846 
## F-statistic: 198.8 on 19 and 471 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Here I’ll show the plots of how 2018 height varies with each of the predictors, starting with dbh, which is highly correlated with heights. There is a clear difference between the constants for redwood and douglas-fir. While most of the slopes seem parallel, Treatment H40 seems different and if we look at just that treatment, the interaction is significant.</p>
<pre class="r"><code>plot_groups(response = ht, predictor = dbh, title = &quot;Height vs dbh&quot;)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-11-1.png" width="1008" /></p>
<p>It would seem that when included in the entire model, the effect adding a dummy variable for the interaction between spp, dbh and treatment is not quite significant.</p>
<p>Next I’ll plot first period ht increment, this was included in the model but without any interactions, so the first plot shows its effect without any groupings. The second plot shows its relationship with spp and treatment groups, this variation is not included in the model.</p>
<pre class="r"><code>plot_groups(
  group = TRUE,
  response = ht,
  predictor = ht_inc_1, title = &quot;Height vs first period ht increment&quot;,
  by_spp = FALSE
)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-12-1.png" width="384" /></p>
<pre class="r"><code>plot_groups(
  response = ht,
  predictor = ht_inc_1,
  title = &quot;Height vs first period ht increment\nwith interactions&quot;
)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-13-1.png" width="960" /></p>
<p>Finally, here is a plot of 2013 ht and 2018 heights. Because the model currently has this variable interacting with treatment and species, this is a more accurate representation of its effect (in the model). Its funny though, if I were to guess, it seems like this predictor is the most consistent across species and treatments.</p>
<pre class="r"><code>plot_groups(response = ht, predictor = ht_13, title = &quot;Height vs 2013 height&quot;)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-14-1.png" width="1008" /></p>
<p>This is what it looks like if I group 2018 heights into thinned and unthinned groups.</p>
<pre class="r"><code>test_d2 &lt;- mutate(
  test_d, treatment = if_else(
    str_detect(treatment, &quot;C&quot;),
    &quot;unthinned&quot;,
    &quot;thinned&quot;
    )
  )

mod4 &lt;- lm(ht ~ 0 + ht_13:spp:treatment, data = test_d2)
summary(mod4)</code></pre>
<pre><code>## 
## Call:
## lm(formula = ht ~ 0 + ht_13:spp:treatment, data = test_d2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.7858 -0.9317  0.0713  0.9658  5.9924 
## 
## Coefficients:
##                                   Estimate Std. Error t value Pr(&gt;|t|)    
## ht_13:sppPSMEM:treatmentthinned   1.078411   0.004403  244.93   &lt;2e-16 ***
## ht_13:sppSESE3:treatmentthinned   1.071188   0.005991  178.79   &lt;2e-16 ***
## ht_13:sppPSMEM:treatmentunthinned 1.066489   0.007061  151.03   &lt;2e-16 ***
## ht_13:sppSESE3:treatmentunthinned 1.068227   0.013877   76.98   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.625 on 487 degrees of freedom
##   (487 observations deleted due to missingness)
## Multiple R-squared:  0.996,  Adjusted R-squared:  0.9959 
## F-statistic: 3.017e+04 on 4 and 487 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>plot_groups(
  predictor = ht_13,
  response = ht,
  group = if_else(str_detect(treatment, &quot;C&quot;), &quot;unthinned&quot;, &quot;thinned&quot;),
  title = &quot;Height increment vs dbh\nthinned vs unthinned&quot;
)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="non-linear-height-dbh-model" class="section level1">
<h1>Non-linear height-dbh model</h1>
<p>What if I just use a height/dbh model suggested by Eng, Hanus et al. and Curtis. And what if I combine 2013 and 2018 datasets? This contributes a lot more data. Maybe averaging across all treatments represents a conservative strategy in that any significant differences would likely not be due to the prediction.</p>
<pre class="r"><code>palette(&quot;Set 2&quot;)
d &lt;- p_h %&gt;% filter(year %in% c(&quot;13&quot;, &quot;18&quot;), status == 1, !get_cond(2, 3), spp %in% c(&quot;SESE3&quot;, &quot;PSMEM&quot;))
d1 &lt;- d %&gt;% filter(spp == &quot;SESE3&quot;)
d2 &lt;- d %&gt;% filter(spp == &quot;PSMEM&quot;)

ht_mod1 &lt;- nls(
  ht ~ 1.3 + exp(b0 + b1 * I(dbh^b2)),
  data = d1, 
  start = list(b0 = 5, b1 = -5, b2 = -.5)
)
ht_mod2 &lt;- nls(ht ~ 1.3 + exp(b0 + b1 * I(dbh^b2)),
  data = d2,
  start = list(b0 = 5, b1 = -5, b2 = -.5)
)

nls_plot &lt;- function(color = spp, facet = NULL, title, col = NULL) {
  palette(&quot;Tableau 10&quot;)
  if (is.null(col)) col &lt;- 1:length(palette())
  facet &lt;- enquo(facet)
  aesth &lt;- aes(dbh, ht, color = {{color}})
  p &lt;- ggplot(arrange(d, spp), aesth) +
  geom_jitter(height = .5, width = .5, alpha = .3) +
  geom_smooth(
    method = &quot;nls&quot;,
    formula = y ~ 1.3 + exp(b0 + b1 * I(x^b2)),
    method.args = list(start = list(b0 = 5, b1 = -5, b2 = -.5)),
    se = FALSE,
    size = 1.3
    ) +
  scale_color_manual(values = palette()[col]) +
  labs(title = title) +
  if(!is.null(facet)) facet_wrap(vars(!!facet))
  print(p)
}</code></pre>
<pre class="r"><code>title &lt;- &quot;Non linear model by species for 2013 and 2018\nAll treatments&quot;
nls_plot(title = title)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-17-1.png" width="768" /></p>
<pre class="r"><code>title &lt;- &quot;difference in fit between 2013 and 2018&quot;
nls_plot(color = year, facet = spp, title = title, col = c(9, 7))</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-17-2.png" width="768" /></p>
<pre class="r"><code>title &lt;- &quot;Difference in fit between treatments\nyears 2013 and 2018&quot;
nls_plot(facet = treatment, color = spp, title = title)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-17-3.png" width="768" /></p>
<pre class="r"><code>title &lt;- &quot;Differences between treatments\nyears 2013 and 2018&quot;
nls_plot(color = treatment, facet = spp, title = title)</code></pre>
<p><img src="03_pred_ht_files/figure-html/unnamed-chunk-17-4.png" width="768" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
